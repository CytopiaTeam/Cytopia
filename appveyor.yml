version: 0.2-CIBuild-{build}
pull_requests:
  do_not_increment_build_number: true
image: Visual Studio 2017
configuration: Release
clone_depth: 10
cache: C:/Users/appveyor/.conan/
environment:
  BUTLER_API_KEY:
    secure: PbT7/2muaC99K24vd6d+DMQETnal230eqmdPtw4tn+zqhwkKpSRIJgjRmJPxphBF
install:
- cmd: >-
    git submodule update --init --recursive

    choco install ninja conan -y

    refreshenv

    call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars64.bat"

    conan user
build_script:
- cmd: >-
    cmake -GNinja -DCMAKE_BUILD_TYPE=Release .

    ninja
test: off
deploy_script:
- ps: >-
    if (($env:APPVEYOR_REPO_BRANCH -eq "master") -and (-Not $env:APPVEYOR_PULL_REQUEST_NUMBER)) {
    iex (new-object net.webclient).downloadstring('https://get.scoop.sh');
    scoop install https://raw.githubusercontent.com/AnotherFoxGuy/scoop-bucket/master/butler.json;
    butler push bin cytopia/cytopia:windows-ci --userversion $env:APPVEYOR_BUILD_VERSION;}
on_success:
- cmd: >-
    RD /S /Q C:\Users\appveyor\.conan\data\sdl2_mixer\2.0.4\anotherfoxguy\stable\build\ & exit 0

    RD /S /Q C:\Users\appveyor\.conan\data\sdl2_mixer\2.0.4\anotherfoxguy\stable\source\ & exit 0
